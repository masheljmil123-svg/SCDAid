<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SCDAid</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="topbar">
    <div class="brand">
     <div class="logo">SCD</div>
      <div>
        <div id="titleText" class="title">SCDAid</div>
        <div id="subtitleText" class="subtitle">...</div>
      </div>
    </div>

    <button id="langToggle" class="btn ghost">AR</button>
  </div>

  <main class="wrap">
    <section class="left">
      <div class="card">
        <div class="cardHeader">
          <h2 id="patientInputsTitle">Patient Inputs</h2>
        </div>

        <div class="grid">
          <div class="field">
            <label id="ageLabel" for="ageInput">Age (years) *</label>
            <input id="ageInput" type="number" min="0" placeholder="e.g., 24" />
          </div>

          <div class="field">
            <label id="weightLabel" for="weightInput">Weight *</label>
            <div class="row">
              <input id="weightInput" type="number" min="0" placeholder="e.g., 70" />
              <select id="weightUnit">
                <option value="kg">kg</option>
                <option value="lb">lb</option>
              </select>
            </div>
            <div id="weightHint" class="hint">...</div>
          </div>

          <div class="field">
            <label id="egfrLabel" for="gfrInput">eGFR *</label>
            <input id="gfrInput" type="number" min="0" placeholder="e.g., 110" />
            <div id="egfrHint" class="hint">...</div>
          </div>

          <div class="field">
            <label id="doseUnitLabel" for="doseUnit">Output Dose Unit</label>
            <select id="doseUnit">
              <option value="mg">mg</option>
              <option value="mcg">mcg</option>
              <option value="g">g</option>
            </select>
            <div id="doseUnitHint" class="hint">...</div>
          </div>

          <div class="field">
            <label id="crisesLabel" for="crisesInput">Pain crises/year (optional)</label>
            <input id="crisesInput" type="number" min="0" placeholder="e.g., 4" />
          </div>

          <div class="field">
            <label id="severityLabel" for="severityInput">Pain severity *</label>
            <select id="severityInput">
              <option value="mild">Mild</option>
              <option value="moderate" selected>Moderate</option>
              <option value="severe">Severe</option>
            </select>
          </div>

          <div class="field">
            <label id="genoAvailLabel" for="genoAvail">CYP2D6 genotype availability</label>
            <select id="genoAvail">
              <option value="known" selected>Known</option>
              <option value="unknown">Unknown</option>
            </select>
            <div id="genoAvailHint" class="hint">...</div>
          </div>

          <div class="field">
            <label id="cypLabel" for="cyp2d6Input">CYP2D6 phenotype</label>
            <select id="cyp2d6Input">
              <option value="PM">Poor (PM)</option>
              <option value="IM">Intermediate (IM)</option>
              <option value="EM" selected>Normal (NM/EM)</option>
              <option value="UM">Ultrarapid (UM)</option>
            </select>
          </div>

          <!-- ✅ UPDATED: CYP2D6 Alleles (replace Activity Score input) -->
          <div class="field">
            <label for="cyp2d6_allele1">CYP2D6 allele 1</label>
            <input id="cyp2d6_allele1" type="text" placeholder="e.g., *1" />
            <div class="hint">Enter allele 1 (e.g., *1, *4, *10, *41). Supports duplication (e.g., *1x2).</div>
          </div>

          <div class="field">
            <label for="cyp2d6_allele2">CYP2D6 allele 2</label>
            <input id="cyp2d6_allele2" type="text" placeholder="e.g., *10" />
            <div class="hint">Tool will auto-calculate activity score and classify phenotype (CPIC thresholds).</div>
          </div>

          <!-- ✅ NEW: Optional Gene (choose second gene) -->
          <div class="field">
            <label for="optional_gene_select">Optional gene (choose one)</label>
            <select id="optional_gene_select">
              <option value="" selected>None</option>
              <option value="OPRM1">OPRM1 (A118G)</option>
              <option value="COMT">COMT (Val158Met)</option>
            </select>
            <div class="hint">Optional modifiers (informational only).</div>
          </div>

          <!-- ✅ NEW: Optional Gene Genotype (auto-filled by app.js on selection) -->
          <div class="field">
            <label for="optional_gene_genotype">Genotype</label>
            <select id="optional_gene_genotype"></select>
            <div class="hint">Will populate after choosing an optional gene above.</div>
          </div>

        </div>

        <!-- Phenotype Prediction (API) -->
        <div class="divider"></div>

        <div class="box">
          <h3 id="phenoPredTitle">Phenotype Prediction (API)</h3>
          <div id="phenoPredHint" class="hint">...</div>

          <div class="grid" style="margin-top:12px;">
            <div class="field">
              <label id="sexLabel" for="sexInput">Sex</label>
              <select id="sexInput">
                <option value="F" selected>F</option>
                <option value="M">M</option>
              </select>
            </div>

            <div class="field">
              <label id="inhibitorLabel" for="inhibitorInput">CYP2D6 inhibitor</label>
              <select id="inhibitorInput">
                <option value="no" selected>No</option>
                <option value="yes">Yes</option>
              </select>
              <div id="inhibitorHint" class="hint">...</div>
            </div>

            <div class="field">
              <label id="codeineRespLabel" for="codeineRespInput">Prior codeine response</label>
              <select id="codeineRespInput">
                <option value="ineffective" selected>Ineffective</option>
                <option value="effective">Effective</option>
                <option value="adverse">Adverse effects</option>
              </select>
            </div>

            <div class="field">
              <label id="tramadolRespLabel" for="tramadolRespInput">Prior tramadol response</label>
              <select id="tramadolRespInput">
                <option value="ineffective" selected>Ineffective</option>
                <option value="effective">Effective</option>
                <option value="adverse">Adverse effects</option>
              </select>
            </div>
          </div>

          <div class="row" style="margin-top:12px; gap:10px;">
            <button id="predictBtn" class="btn">Predict Phenotype</button>
            <div id="predictStatus" class="predictStatus"></div>
          </div>
        </div>

        <!-- ALWAYS visible genotype-unavailable guidance box -->
        <div class="divider"></div>

        <div class="box infoBox">
          <h3 id="genoBoxTitle">If CYP2D6 genotype is unavailable</h3>
          <div id="genoBoxIntro" class="hint" style="margin-top:6px;">...</div>

          <ol id="genoBoxList" class="ol">
            <!-- filled by app.js (language toggle) -->
          </ol>

          <div class="note" id="genoBoxNote">...</div>
        </div>

        <!-- flags -->
        <div class="divider"></div>

        <div class="checks">
          <label class="chk"><input id="opioidTol" type="checkbox" /> <span id="opioidTolLabel">Opioid tolerant</span></label>
          <label class="chk"><input id="sedatives" type="checkbox" /> <span id="sedativesLabel">Concurrent sedatives</span></label>
          <label class="chk"><input id="respRisk" type="checkbox" /> <span id="respRiskLabel">Respiratory risk</span></label>
          <label class="chk"><input id="suspectedACS" type="checkbox" /> <span id="acsLabel">Suspected ACS</span></label>
          <label class="chk"><input id="morphineAllergy" type="checkbox" /> <span id="morphineAllergyLabel">Morphine allergy</span></label>

          <!-- ✅ NEW: Nephropathy flag (under flags) -->
          <label class="chk">
            <input id="flag_nephropathy" type="checkbox" />
            <span>SCD nephropathy (albuminuria/proteinuria or CKD)</span>
          </label>
        </div>

        <div class="actions">
          <button id="runBtn" class="btn primary">Run Algorithm</button>
          <button id="resetBtn" class="btn ghost">Reset</button>
        </div>

        <div id="disclaimerText" class="disclaimer">Educational prototype only…</div>
      </div>

      <div class="card refs">
        <div class="cardHeader">
          <h2 id="refsTitle">References</h2>
        </div>
        <ul class="refList">
          <li><a id="mohLink" target="_blank" rel="noreferrer">Saudi MOH Protocol</a></li>
          <li><a id="cpicLink" target="_blank" rel="noreferrer">CPIC CYP2D6</a></li>
          <li><a id="ashLink" target="_blank" rel="noreferrer">ASH VOC Guideline</a></li>
          <li><a id="owsianyLink" target="_blank" rel="noreferrer">Owsiany et al.</a></li>
        </ul>
      </div>
    </section>

    <section class="right">
      <div class="card">
        <div class="cardHeader">
          <h2 id="resultsTitle">Results</h2>
        </div>
        <div id="results">
          <div id="placeholderText" class="placeholder">Enter inputs then click "Run Algorithm".</div>
        </div>
      </div>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
