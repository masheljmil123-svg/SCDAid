<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SCDAid</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="Logo.png" alt="SCDAid" class="logo" onerror="this.style.display='none'">
      <div>
        <div class="brand-title">SCDAid</div>
        <div class="brand-subtitle" id="subtitle">Genotype & Renal-Aware VOC Pain Decision Tool</div>
      </div>
    </div>

    <div class="topbar-actions">
      <button id="langToggle" class="btn ghost">AR</button>
      <a class="btn ghost" href="#refs">References</a>
    </div>
  </header>

  <main class="container">
    <section class="grid">
      <!-- LEFT: Inputs -->
      <div class="card">
        <h2 id="inputsTitle">Inputs</h2>

        <div class="field">
          <label id="ageLabel" for="age">Age</label>
          <input id="age" type="number" min="0" placeholder="e.g., 24" />
        </div>

        <div class="field">
          <label id="weightLabel" for="weight">Weight (kg)</label>
          <input id="weight" type="number" min="1" step="0.1" placeholder="e.g., 70" />
        </div>

        <div class="field">
          <label id="egfrLabel" for="egfr">eGFR (mL/min/1.73m²)</label>
          <input id="egfr" type="number" min="0" step="1" placeholder="e.g., 110" />
          <div class="hint" id="egfrHint">Used for renal dose adjustment and safety flags.</div>
        </div>

        <div class="field">
          <label id="crisesLabel" for="crisesPerYear">Pain crises/year (optional)</label>
          <input id="crisesPerYear" type="number" min="0" placeholder="e.g., 4" />
        </div>

        <div class="field">
          <label id="severityLabel" for="severity">Pain severity</label>
          <select id="severity">
            <option value="mild">Mild</option>
            <option value="moderate" selected>Moderate</option>
            <option value="severe">Severe</option>
          </select>
        </div>

        <div class="field">
          <label id="genoAvailLabel" for="genoAvail">CYP2D6 genotype availability</label>
          <select id="genoAvail">
            <option value="known" selected>Known</option>
            <option value="unknown">Unknown</option>
          </select>
          <div class="hint" id="genoAvailHint">If unknown, tool avoids CYP2D6-dependent opioids.</div>
        </div>

        <div class="field">
          <label id="cypLabel" for="cyp2d6">CYP2D6 phenotype</label>
          <select id="cyp2d6">
            <option value="PM">Poor (PM)</option>
            <option value="IM">Intermediate (IM)</option>
            <option value="NM" selected>Normal (NM)</option>
            <option value="UM">Ultrarapid (UM)</option>
          </select>
        </div>

        <!-- ✅ ALWAYS VISIBLE EDUCATIONAL BOX -->
        <div class="field">
          <details id="genoInfoBox" class="geno-info" open>
            <summary>
              <span id="genoInfoTitle">If CYP2D6 genotype is unavailable</span>
            </summary>

            <div class="geno-info-body">
              <div id="genoInfoIntro" class="geno-info-intro">
                Clinical indicators suggestive of altered CYP2D6 activity (informational only; does not replace genotyping):
              </div>

              <ol class="geno-info-list">
                <li>
                  <div class="geno-info-head" id="genoInfo1Title">Past response (strongest clue):</div>
                  <ul>
                    <li id="genoInfo1a">Possible UM: marked sedation/respiratory depression or severe nausea on small doses of codeine/tramadol.</li>
                    <li id="genoInfo1b">Possible PM: no analgesic effect despite maximum recommended doses of codeine/tramadol.</li>
                  </ul>
                </li>

                <li>
                  <div class="geno-info-head" id="genoInfo2Title">Drug–drug interactions (phenoconversion):</div>
                  <ul>
                    <li id="genoInfo2a">Strong CYP2D6 inhibitors (e.g., fluoxetine, paroxetine) may make a normal genotype behave like PM.</li>
                  </ul>
                </li>

                <li>
                  <div class="geno-info-head" id="genoInfo3Title">Ethnicity/geography:</div>
                  <ul>
                    <li id="genoInfo3a">Some Middle Eastern/North African populations show higher prevalence of UM alleles; use caution with first-time codeine.</li>
                  </ul>
                </li>

                <li>
                  <div class="geno-info-head" id="genoInfo4Title">Organ function (secondary modifiers):</div>
                  <ul>
                    <li id="genoInfo4a">Liver/renal impairment can amplify toxicity or mask expected response; monitor closely.</li>
                  </ul>
                </li>

                <li>
                  <div class="geno-info-head" id="genoInfo5Title">Therapeutic drug monitoring (rare):</div>
                  <ul>
                    <li id="genoInfo5a">In specialized centers, high codeine with near-zero morphine may suggest PM.</li>
                  </ul>
                </li>
              </ol>

              <div class="geno-info-note">
                <div class="geno-info-head" id="genoInfoNoteTitle">Clinical note:</div>
                <div id="genoInfoNoteBody">If genotype is unknown and codeine/tramadol is being considered, prefer non–CYP2D6-dependent options and monitor closely.</div>
              </div>
            </div>
          </details>
        </div>

        <div class="divider"></div>

        <h3 id="mlTitle">Phenotype Prediction (API)</h3>
        <div class="hint" id="mlHint">Optional: use local API to predict CYP2D6 phenotype and auto-fill the field above.</div>

        <div class="field">
          <label id="sexLabel" for="sex">Sex</label>
          <select id="sex">
            <option value="F" selected>F</option>
            <option value="M">M</option>
          </select>
        </div>

        <div class="field">
          <label id="inhibLabel" for="cyp2d6Inhibitor">CYP2D6 inhibitor</label>
          <select id="cyp2d6Inhibitor">
            <option value="no" selected>No</option>
            <option value="yes">Yes</option>
          </select>
          <div class="hint" id="inhibHint">Examples: strong CYP2D6 inhibitors may reduce CYP2D6 activity.</div>
        </div>

        <div class="field">
          <label id="codeineLabel" for="priorCodeine">Prior codeine response</label>
          <select id="priorCodeine">
            <option value="effective">Effective</option>
            <option value="ineffective" selected>Ineffective</option>
            <option value="adverse">Adverse effects</option>
            <option value="unknown">Unknown</option>
          </select>
        </div>

        <div class="field">
          <label id="tramadolLabel" for="priorTramadol">Prior tramadol response</label>
          <select id="priorTramadol">
            <option value="effective">Effective</option>
            <option value="ineffective" selected>Ineffective</option>
            <option value="adverse">Adverse effects</option>
            <option value="unknown">Unknown</option>
          </select>
        </div>

        <div class="row">
          <button id="predictBtn" class="btn">Predict Phenotype</button>
          <span id="mlBadge" class="badge hidden"></span>
          <span id="confBadge" class="badge hidden"></span>
        </div>

        <div id="mlDetails" class="small muted"></div>

        <div class="divider"></div>

        <div class="checkboxes">
          <label><input type="checkbox" id="opioidTolerant"> <span id="opioidTolLabel">Opioid tolerant</span></label>
          <label><input type="checkbox" id="sedatives"> <span id="sedLabel">Concurrent sedatives</span></label>
          <label><input type="checkbox" id="respRisk"> <span id="respLabel">Respiratory risk</span></label>
          <label><input type="checkbox" id="acsRisk"> <span id="acsLabel">Suspected ACS</span></label>
          <label><input type="checkbox" id="morphAllergy"> <span id="allergyLabel">Morphine allergy</span></label>
        </div>

        <div class="row">
          <button id="runBtn" class="btn primary">Run Algorithm</button>
          <button id="resetBtn" class="btn ghost">Reset</button>
        </div>

        <div class="disclaimer" id="disclaimer">
          Educational prototype only. Not a substitute for clinical judgment.
        </div>
      </div>

      <!-- RIGHT: Output -->
      <div class="card">
        <h2 id="outputTitle">Output</h2>
        <div id="output" class="output"></div>
      </div>
    </section>

    <section id="refs" class="card refs">
      <h2 id="refsTitle">References</h2>
      <ul id="refsList"></ul>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
